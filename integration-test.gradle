sourceSets {
    integrationTest {
        java {
            compileClasspath += main.output + test.output
            runtimeClasspath += main.output + test.output
            srcDir file('src/integrationTest/java')
        }
        resources.srcDir file('src/integrationTest/resources')
    }
}

task integrationTest(type: Test) {
    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath
    outputs.upToDateWhen { false }

    testLogging {
        showStandardStreams = true
        events 'started', 'passed'
    }

    systemProperties project.properties.subMap(["foo", "bar"])

    useJUnit {
        excludeCategories 'com.infinera.metro.dnam.acceptance.test.node.DontLetGradleRun'
    }
}

configurations {
    integrationTestCompile.extendsFrom testCompile
    integrationTestRuntime.extendsFrom testRuntime

    check.dependsOn integrationTest
    integrationTest.mustRunAfter test
}

tasks.withType(Test) {
    reports.html.setDestination(new File("${reportsDir}/${testReportDirName}/${name}"))

}